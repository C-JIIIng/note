# Kafka

## 1. 概述

### 1.1 定义

Kafka 是一个 **分布式** 的基于 **发布/订阅模式** 的 **消息队列**（Message Queue），主要应用与大数据实时处理领域。

### 1.2 特性

+ **消息持久化**：采用时间复杂度O(1)的磁盘存储结构，即使在TB级以上数据也能保证常数时间的访问速度
+ 高吞吐
+ **高容错**：多分区，多副本
+ **易扩展**：新增机器，集群无需停机，自动感知
+ 同时支持离线、实时数据处理

### 1.3 应用场景

+ 异步通讯

  + 将消息放入 Kafka，可以不立即处理

+ 应用解耦

  + 在应用处理过程中插入一个隐含的、基于数据的接口层

+ 峰值处理

  + 使关键应用能够顶住访问峰值，不会因超出负荷而崩溃

  ![image-20200308204352425](D:\Desktop\面试\img\image-20200308204352425.png)



## 2. Kafka 原理

### 2.1  基本概念



+ Broker（代理）
  + Kafka 的一个实例或节点，一个或多个 Broker 组成一个Kafka 集群
+ Topic（主题）
  + Topic 是 Kafka 中**同一类数据的集合**，相当于数据库中的表
  + producer 将同一类数据写入同一个 Topic， Consumer 从同一个 Topic 中读取同类数据
  + Topic 是**逻辑概念**，用户只需指定 Topic 就可以生产或消费数据，不必关心数据存于何处
+ Partition（分区）
  + 分区是一个 **有序的、不可修改的消息队列**，分区内消息有序存储
  + 一个Topic 可分为多个分区，相当于把一个数据集分为多份，分别存储不同的分区中
  + Partition 是**物理概念**，**每个分区对应一个文件夹**，其中存储分区的数据和索引文件
+ Replication（副本）
  + 一个分区可以设置多个副本，副本存储在不同的Broker中
+ Producer（消息生产者）
  + 向Broker发布消息的客户端
+ Consumer（消息消费者）
  + 向 Broker 消费消息的客户端

+ Consumer Group（CG ，消费者组）
  + 每个Consumer 都隶属于一个特定的 CG
  + **一条消息可以发送给多个不同的 CG，但一个CG只能有一个Consumer 读取该消息**，因此CG中的consumer个数不应超过topic的分区数
+ Zookeeper
  + Kafka 将**元数据**保存在Zookeeper 中
  + 负责**Kafka集群管理**，包括配置管理、动态扩展、Broker负载均衡、Leader选举、以及CG变化时的Rebalance

### 2.2 工作机制

