# 一个完整的基于Node.js的web应用



## 用例

我们来分解一下这个应用，为了实现上文的用例，我们需要实现哪些部分呢？

- 我们需要提供Web页面，因此需要一个*HTTP服务器*
- 对于不同的请求，根据请求的URL，我们的服务器需要给予不同的响应，因此我们需要一个*路由*，用于把请求对应到请求处理程序（request handler）
- 当请求被服务器接收并通过路由传递之后，需要可以对其进行处理，因此我们需要最终的*请求处理程序*
- 路由还应该能处理POST数据，并且把数据封装成更友好的格式传递给请求处理入程序，因此需要*请求数据处理功能*
- 我们不仅仅要处理URL对应的请求，还要把内容显示出来，这意味着我们需要一些*视图逻辑*供请求处理程序使用，以便将内容发送给用户的浏览器
- 最后，用户需要上传图片，所以我们需要*上传处理功能*来处理这方面的细节



## 应用不同模块分析

我们来分解一下这个应用，为了实现上文的用例，我们需要实现哪些部分呢？

- 我们需要提供Web页面，因此需要一个**HTTP服务器**
- 对于不同的请求，根据请求的URL，我们的服务器需要给予不同的响应，因此我们需要一个**路由**，用于把请求对应到请求处理程序（request handler）
- 当请求被服务器接收并通过路由传递之后，需要可以对其进行处理，因此我们需要最终的**请求处理程序**
- 路由还应该能处理POST数据，并且把数据封装成更友好的格式传递给请求处理入程序，因此需要**请求数据处理功能**
- 我们不仅仅要处理URL对应的请求，还要把内容显示出来，这意味着我们需要一些**视图逻辑**供请求处理程序使用，以便将内容发送给用户的浏览器
- 最后，用户需要上传图片，所以我们需要**上传处理功能**来处理这方面的细节



## 构建应用的模块

### 一个基础的HTTP服务器

让我们先从服务器模块开始。在你的项目的根目录下创建一个叫*server.js*的文件，并写入以下代码：

```js
var http = require("http");

http.createServer(function(request, response) {
  response.writeHead(200, {"Content-Type": "text/plain"});
  response.write("Hello World");
  response.end();
}).listen(8888);
```

接下来，打开浏览器访问http://localhost:8888/，你会看到一个写着“Hello World”的网页。

#### 分析HTTP服务器

+ 第一行*请求（require）*Node.js 自带的 *http* 模块，并且把它赋值给 *http* 变量。

+ 接下来我们调用http模块提供的函数： *createServer* 。这个函数会返回一个对象，这个对象有一个叫做 *listen* 的方法，这个方法有一个数值参数，指定这个HTTP服务器监听的端口号。

+ 咱们暂时先不管 *http.createServer* 的括号里的那个函数定义。

  我们本来可以用这样的代码来启动服务器并侦听8888端口：

  ```js
  var http = require("http");
  
  var server = http.createServer();
  server.listen(8888);
  ```

#### 进行函数传递

```js
function execute(someFunction, value) {
  someFunction(value);
}

execute(function(word){ console.log(word) }, "Hello");
```

我们在 *execute* 接受第一个参数的地方直接定义了我们准备传递给 *execute* 的函数。

用这种方式，我们甚至不用给这个函数起名字，这也是为什么它被叫做 *匿名函数*。

#### 基于事件驱动的回调

Node.js 是事件驱动的（event-driven）







